<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MbaloTech Trading App</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Professional trading assistant and journal">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MbaloTech Trading">
    
    <!-- React and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            overscroll-behavior: none;
        }
        
        /* PWA specific styles */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* Loading animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #f3f4f6;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Install prompt styles */
        .install-prompt {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div>
            <div class="spinner"></div>
            <div class="text-center mt-4 text-gray-600">Loading MbaloTech Trading...</div>
        </div>
    </div>

    <!-- App Container -->
    <div id="root" style="display: none;"></div>
    
    <!-- Install Prompt -->
    <div id="install-prompt" class="hidden fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50 install-prompt">
        <div class="flex items-center justify-between">
            <div>
                <div class="font-semibold">Install MbaloTech Trading</div>
                <div class="text-sm opacity-90">Get the full app experience</div>
            </div>
            <div class="flex space-x-2">
                <button id="install-dismiss" class="px-3 py-1 bg-white bg-opacity-20 rounded text-sm">
                    Later
                </button>
                <button id="install-accept" class="px-3 py-1 bg-white text-blue-600 rounded text-sm font-medium">
                    Install
                </button>
            </div>
        </div>
    </div>

    <script>
        // Service Worker and PWA Setup
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'mbalotech-trading-v1';
                    const urlsToCache = ['./', './index.html'];

                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                const swBlob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(swBlob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install functionality
        let deferredPrompt;
        const installPrompt = document.getElementById('install-prompt');
        const installAccept = document.getElementById('install-accept');
        const installDismiss = document.getElementById('install-dismiss');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            setTimeout(() => {
                if (!window.matchMedia('(display-mode: standalone)').matches) {
                    installPrompt.classList.remove('hidden');
                }
            }, 10000);
        });

        installAccept.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
            }
            installPrompt.classList.add('hidden');
        });

        installDismiss.addEventListener('click', () => {
            installPrompt.classList.add('hidden');
        });

        // Enhanced Storage
        const Storage = {
            set: (key, value) => {
                try {
                    localStorage.setItem('mbalotech_' + key, JSON.stringify(value));
                    return true;
                } catch (e) {
                    console.warn('Storage quota exceeded');
                    return false;
                }
            },
            get: (key) => {
                try {
                    const item = localStorage.getItem('mbalotech_' + key);
                    return item ? JSON.parse(item) : null;
                } catch (e) {
                    console.warn('Storage error for key:', key);
                    return null;
                }
            },
            remove: (key) => {
                try {
                    localStorage.removeItem('mbalotech_' + key);
                } catch (e) {
                    console.warn('Storage removal error');
                }
            },
            clear: () => {
                try {
                    Object.keys(localStorage).forEach(key => {
                        if (key.startsWith('mbalotech_')) {
                            localStorage.removeItem(key);
                        }
                    });
                } catch (e) {
                    console.warn('Storage clear error');
                }
            }
        };

        window.MbaloStorage = Storage;
    </script>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Icon Components
        const CheckCircle = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('path', { d: "M22 11.08V12a10 10 0 1 1-5.93-9.14" }),
            React.createElement('polyline', { points: "9,11 12,14 22,4" })
        );

        const XCircle = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
            React.createElement('line', { x1: "15", y1: "9", x2: "9", y2: "15" }),
            React.createElement('line', { x1: "9", y1: "9", x2: "15", y2: "15" })
        );

        const TrendingUp = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('polyline', { points: "23,6 13.5,15.5 8.5,10.5 1,18" }),
            React.createElement('polyline', { points: "17,6 23,6 23,12" })
        );

        const Lock = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('rect', { x: "3", y: "11", width: "18", height: "11", rx: "2", ry: "2" }),
            React.createElement('circle', { cx: "12", cy: "16", r: "1" }),
            React.createElement('path', { d: "M7 11V7a5 5 0 0 1 10 0v4" })
        );

        const Target = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
            React.createElement('circle', { cx: "12", cy: "12", r: "6" }),
            React.createElement('circle', { cx: "12", cy: "12", r: "2" })
        );

        const BarChart3 = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('path', { d: "M3 3v18h18" }),
            React.createElement('path', { d: "M18 17V9" }),
            React.createElement('path', { d: "M13 17V5" }),
            React.createElement('path', { d: "M8 17v-3" })
        );

        const Clock = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
            React.createElement('polyline', { points: "12,6 12,12 16,14" })
        );

        const AlertTriangle = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('path', { d: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" }),
            React.createElement('line', { x1: "12", y1: "9", x2: "12", y2: "13" }),
            React.createElement('line', { x1: "12", y1: "17", x2: "12.01", y2: "17" })
        );

        const Settings = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('circle', { cx: "12", cy: "12", r: "3" }),
            React.createElement('path', { d: "M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" })
        );

        const Plus = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('line', { x1: "12", y1: "5", x2: "12", y2: "19" }),
            React.createElement('line', { x1: "5", y1: "12", x2: "19", y2: "12" })
        );

        const Activity = () => React.createElement('svg', {
            width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
        }, 
            React.createElement('polyline', { points: "22,12 18,12 15,21 9,3 6,12 2,12" })
        );

        // Main App Component
        const MbaloTechTradingApp = () => {
            // State management
            const [currentView, setCurrentView] = useState('dashboard');
            const [isLocked, setIsLocked] = useState(false);
            const [lockReason, setLockReason] = useState('');
            const [lockUntil, setLockUntil] = useState(null);
            
            const [trades, setTrades] = useState([]);
            const [activeTrades, setActiveTrades] = useState([]);
            const [tradingRules, setTradingRules] = useState({
                maxDailyLoss: 1000,
                maxPositionSize: 0.1,
                maxRiskPerTrade: 2,
                maxConsecutiveLosses: 2,
                maxDailyTrades: 5,
                mandatoryBreakHours: 24
            });

            const [dailyStats, setDailyStats] = useState({
                date: new Date().toISOString().split('T')[0],
                tradesCount: 0,
                dailyPnL: 0,
                maxDrawdown: 0,
                consecutiveLosses: 0,
                emotionalState: 5,
                discipline: 5,
                focus: 5,
                marketConditions: 'normal'
            });

            const [preTradeChecklist, setPreTradeChecklist] = useState({
                marketAnalysis: false,
                riskAssessment: false,
                emotionalCheck: false,
                positionSize: false,
                exitStrategy: false,
                timeAvailable: false,
                newsCheck: false,
                technicalSetup: false
            });

            const [currentTrade, setCurrentTrade] = useState({
                id: null,
                symbol: '',
                side: 'long',
                entryPrice: '',
                stopLoss: '',
                takeProfit: '',
                positionSize: '',
                timeframe: '1h',
                setup: 'breakout',
                confidence: 3,
                emotionalState: 'calm',
                marketCondition: 'trending',
                notes: '',
                riskRewardRatio: 0,
                riskAmount: 0,
                potentialReward: 0
            });

            // Load data from storage on startup
            useEffect(() => {
                const savedTrades = window.MbaloStorage.get('trades') || [];
                const savedRules = window.MbaloStorage.get('tradingRules');
                const savedStats = window.MbaloStorage.get('dailyStats');
                const savedLock = window.MbaloStorage.get('lockStatus');
                
                if (savedTrades.length > 0) setTrades(savedTrades);
                if (savedRules) setTradingRules(savedRules);
                if (savedStats && savedStats.date === new Date().toISOString().split('T')[0]) {
                    setDailyStats(savedStats);
                }
                if (savedLock && savedLock.isLocked) {
                    setIsLocked(savedLock.isLocked);
                    setLockReason(savedLock.reason);
                    setLockUntil(savedLock.until);
                }

                // Add some sample data if no trades exist
                if (savedTrades.length === 0) {
                    const sampleTrades = [
                        {
                            id: 1,
                            symbol: 'EURUSD',
                            side: 'long',
                            entryPrice: '1.08500',
                            stopLoss: '1.08000',
                            takeProfit: '1.09500',
                            positionSize: '0.01',
                            timeframe: '1h',
                            setup: 'breakout',
                            confidence: 4,
                            timestamp: new Date(Date.now() - 3600000).toISOString(),
                            status: 'closed',
                            pnl: 450,
                            outcome: 'win',
                            notes: 'Good breakout setup with volume confirmation'
                        },
                        {
                            id: 2,
                            symbol: 'GBPJPY',
                            side: 'short',
                            entryPrice: '188.50',
                            stopLoss: '189.00',
                            takeProfit: '187.00',
                            positionSize: '0.01',
                            timeframe: '4h',
                            setup: 'reversal',
                            confidence: 3,
                            timestamp: new Date(Date.now() - 7200000).toISOString(),
                            status: 'closed',
                            pnl: -250,
                            outcome: 'loss',
                            notes: 'Hit stop loss, market continued higher than expected'
                        }
                    ];
                    setTrades(sampleTrades);
                    window.MbaloStorage.set('trades', sampleTrades);
                }
            }, []);

            // Save data to storage when state changes
            useEffect(() => {
                if (trades.length > 0) {
                    window.MbaloStorage.set('trades', trades);
                }
            }, [trades]);

            useEffect(() => {
                window.MbaloStorage.set('tradingRules', tradingRules);
            }, [tradingRules]);

            useEffect(() => {
                window.MbaloStorage.set('dailyStats', dailyStats);
            }, [dailyStats]);

            useEffect(() => {
                window.MbaloStorage.set('lockStatus', {
                    isLocked,
                    reason: lockReason,
                    until: lockUntil
                });
            }, [isLocked, lockReason, lockUntil]);

            // Input handlers
            const handleTradeInputChange = useCallback((field, value) => {
                setCurrentTrade(prev => {
                    const updated = { ...prev, [field]: value };
                    
                    if (['entryPrice', 'stopLoss', 'takeProfit', 'positionSize'].includes(field)) {
                        const entry = parseFloat(updated.entryPrice) || 0;
                        const stop = parseFloat(updated.stopLoss) || 0;
                        const target = parseFloat(updated.takeProfit) || 0;
                        const size = parseFloat(updated.positionSize) || 0;
                        
                        if (entry && stop && target && size) {
                            const riskPips = updated.side === 'long' ? 
                                Math.abs(entry - stop) : Math.abs(stop - entry);
                            const rewardPips = updated.side === 'long' ? 
                                Math.abs(target - entry) : Math.abs(entry - target);
                            
                            updated.riskRewardRatio = rewardPips / riskPips;
                            updated.riskAmount = riskPips * size * 100000;
                            updated.potentialReward = rewardPips * size * 100000;
                        }
                    }
                    
                    return updated;
                });
            }, []);

            const handleChecklistChange = useCallback((field, checked) => {
                setPreTradeChecklist(prev => ({
                    ...prev,
                    [field]: checked
                }));
            }, []);

            // Statistics calculation
            const calculateStats = useCallback(() => {
                const totalTrades = trades.length;
                const winningTrades = trades.filter(t => t.outcome === 'win').length;
                const losingTrades = trades.filter(t => t.outcome === 'loss').length;
                const winRate = totalTrades > 0 ? (winningTrades / totalTrades * 100).toFixed(1) : 0;
                const totalPnL = trades.reduce((sum, trade) => sum + (trade.pnl || 0), 0);
                
                const avgWin = winningTrades > 0 ? 
                    trades.filter(t => t.outcome === 'win').reduce((sum, t) => sum + t.pnl, 0) / winningTrades : 0;
                const avgLoss = losingTrades > 0 ? 
                    trades.filter(t => t.outcome === 'loss').reduce((sum, t) => sum + Math.abs(t.pnl), 0) / losingTrades : 0;
                const profitFactor = avgLoss > 0 ? (avgWin * winningTrades) / (avgLoss * losingTrades) : 0;
                
                const recentTrades = trades.slice(-5);
                let consecutiveLosses = 0;
                for (let i = recentTrades.length - 1; i >= 0; i--) {
                    if (recentTrades[i].outcome === 'loss') {
                        consecutiveLosses++;
                    } else {
                        break;
                    }
                }
                
                return { 
                    totalTrades, 
                    winningTrades, 
                    losingTrades, 
                    winRate, 
                    totalPnL,
                    avgWin: avgWin.toFixed(0),
                    avgLoss: avgLoss.toFixed(0),
                    profitFactor: profitFactor.toFixed(2),
                    consecutiveLosses
                };
            }, [trades]);

            const stats = calculateStats();

            // Emergency stop function
            const emergencyStop = useCallback((reason) => {
                const lockUntilTime = new Date(Date.now() + (tradingRules.mandatoryBreakHours * 60 * 60 * 1000));
                setIsLocked(true);
                setLockReason(reason);
                setLockUntil(lockUntilTime);
                setActiveTrades([]);
                setPreTradeChecklist({
                    marketAnalysis: false,
                    riskAssessment: false,
                    emotionalCheck: false,
                    positionSize: false,
                    exitStrategy: false,
                    timeAvailable: false,
                    newsCheck: false,
                    technicalSetup: false
                });
                setCurrentView('dashboard');
            }, [tradingRules.mandatoryBreakHours]);

            // Check trading rules violations
            useEffect(() => {
                if (stats.consecutiveLosses >= tradingRules.maxConsecutiveLosses && !isLocked) {
                    emergencyStop(`${tradingRules.maxConsecutiveLosses} consecutive losses - mandatory break`);
                }
                
                if (dailyStats.dailyPnL <= -tradingRules.maxDailyLoss && !isLocked) {
                    emergencyStop(`Daily loss limit reached ($${tradingRules.maxDailyLoss})`);
                }
                
                if (dailyStats.tradesCount >= tradingRules.maxDailyTrades && !isLocked) {
                    emergencyStop(`Daily trade limit reached (${tradingRules.maxDailyTrades})`);
                }
            }, [stats.consecutiveLosses, dailyStats.dailyPnL, dailyStats.tradesCount, tradingRules, isLocked, emergencyStop]);

            // Check if lock should be lifted
            useEffect(() => {
                if (isLocked && lockUntil && new Date() > new Date(lockUntil)) {
                    setIsLocked(false);
                    setLockReason('');
                    setLockUntil(null);
                }
            }, [isLocked, lockUntil]);

            // Pre-Trade Checklist Component
            const PreTradeChecklistView = () => {
                const checklistItems = [
                    { key: 'marketAnalysis', label: 'Market structure and trend analysis completed', critical: true },
                    { key: 'technicalSetup', label: 'Technical setup confirmed with multiple timeframes', critical: true },
                    { key: 'riskAssessment', label: 'Risk/reward ratio calculated (minimum 1:2)', critical: true },
                    { key: 'positionSize', label: 'Position size calculated (max 2% account risk)', critical: true },
                    { key: 'exitStrategy', label: 'Stop loss and take profit levels defined', critical: true },
                    { key: 'emotionalCheck', label: 'Emotional state is calm and focused', critical: false },
                    { key: 'newsCheck', label: 'Economic calendar checked for high-impact news', critical: false },
                    { key: 'timeAvailable', label: 'Sufficient time available to monitor trade', critical: false }
                ];

                const criticalItems = checklistItems.filter(item => item.critical);
                const nonCriticalItems = checklistItems.filter(item => !item.critical);
                const allCriticalChecked = criticalItems.every(item => preTradeChecklist[item.key]);

                return React.createElement('div', { className: 'p-6 bg-white rounded-lg shadow-lg' },
                    React.createElement('div', { className: 'flex items-center justify-between mb-6' },
                        React.createElement('h2', { className: 'text-2xl font-bold' }, 'Pre-Trade Checklist'),
                        React.createElement('div', { className: 'text-sm text-gray-500' },
                            `Critical: ${criticalItems.filter(item => preTradeChecklist[item.key]).length}/${criticalItems.length}`
                        )
                    ),
                    
                    React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', null,
                            React.createElement('h3', { className: 'font-semibold text-red-600 mb-3 flex items-center' },
                                React.createElement(AlertTriangle, { className: 'w-4 h-4 mr-1' }),
                                'Critical Items (Required)'
                            ),
                            React.createElement('div', { className: 'space-y-3' },
                                criticalItems.map(item => 
                                    React.createElement('div', { key: item.key, className: 'flex items-center space-x-3' },
                                        React.createElement('input', {
                                            type: 'checkbox',
                                            checked: preTradeChecklist[item.key],
                                            onChange: (e) => handleChecklistChange(item.key, e.target.checked),
                                            className: 'w-5 h-5 text-red-600'
                                        }),
                                        React.createElement('label', { className: 'text-gray-700' }, item.label)
                                    )
                                )
                            )
                        ),

                        React.createElement('div', null,
                            React.createElement('h3', { className: 'font-semibold text-blue-600 mb-3' }, 'Optional Items'),
                            React.createElement('div', { className: 'space-y-3' },
                                nonCriticalItems.map(item => 
                                    React.createElement('div', { key: item.key, className: 'flex items-center space-x-3' },
                                        React.createElement('input', {
                                            type: 'checkbox',
                                            checked: preTradeChecklist[item.key],
                                            onChange: (e) => handleChecklistChange(item.key, e.target.checked),
                                            className: 'w-5 h-5 text-blue-600'
                                        }),
                                        React.createElement('label', { className: 'text-gray-700' }, item.label)
                                    )
                                )
                            )
                        )
                    ),

                    React.createElement('div', { className: 'mt-8 flex gap-4' },
                        React.createElement('button', {
                            onClick: () => setCurrentView('dashboard'),
                            className: 'flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-gray-600 transition-colors'
                        }, 'Cancel'),
                        React.createElement('button', {
                            onClick: () => allCriticalChecked ? setCurrentView('trade-entry') : null,
                            disabled: !allCriticalChecked,
                            className: `flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${
                                allCriticalChecked 
                                    ? 'bg-green-600 text-white hover:bg-green-700' 
                                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                            }`
                        }, allCriticalChecked ? 'Proceed to Trade Entry' : 'Complete Critical Items')
                    )
                );
            };

            // Trade Entry Component
            const TradeEntryView = () => {
                const isValidTrade = currentTrade.symbol && 
                    currentTrade.entryPrice && 
                    currentTrade.stopLoss && 
                    currentTrade.takeProfit && 
                    currentTrade.positionSize &&
                    currentTrade.riskRewardRatio >= 1.5;

                const submitTrade = () => {
                    if (!isValidTrade) return;
                    
                    const newTrade = {
                        id: Date.now(),
                        ...currentTrade,
                        timestamp: new Date().toISOString(),
                        status: 'active'
                    };
                    
                    setActiveTrades(prev => [...prev, newTrade]);
                    
                    // Simulate trade outcome
                    setTimeout(() => {
                        const outcome = Math.random() > 0.4 ? 'win' : 'loss';
                        const pnl = outcome === 'win' ? 
                            Math.random() * 800 + 200 : 
                            -(Math.random() * 400 + 100);
                        
                        const closedTrade = {
                            ...newTrade,
                            status: 'closed',
                            outcome,
                            pnl,
                            exitPrice: outcome === 'win' ? newTrade.takeProfit : newTrade.stopLoss,
                            exitTime: new Date().toISOString(),
                            duration: Math.floor(Math.random() * 120 + 30)
                        };
                        
                        setTrades(prev => [...prev, closedTrade]);
                        setActiveTrades(prev => prev.filter(t => t.id !== newTrade.id));
                        
                        setDailyStats(prev => ({
                            ...prev,
                            tradesCount: prev.tradesCount + 1,
                            dailyPnL: prev.dailyPnL + pnl
                        }));
                    }, Math.random() * 10000 + 5000);
                    
                    // Reset forms
                    setCurrentTrade({
                        id: null, symbol: '', side: 'long', entryPrice: '', stopLoss: '',
                        takeProfit: '', positionSize: '', timeframe: '1h', setup: 'breakout',
                        confidence: 3, emotionalState: 'calm', marketCondition: 'trending',
                        notes: '', riskRewardRatio: 0, riskAmount: 0, potentialReward: 0
                    });
                    
                    setPreTradeChecklist({
                        marketAnalysis: false, riskAssessment: false, emotionalCheck: false,
                        positionSize: false, exitStrategy: false, timeAvailable: false,
                        newsCheck: false, technicalSetup: false
                    });
                    
                    setCurrentView('dashboard');
                };

                return React.createElement('div', { className: 'p-6 bg-white rounded-lg shadow-lg' },
                    React.createElement('div', { className: 'flex items-center justify-between mb-6' },
                        React.createElement('h2', { className: 'text-2xl font-bold' }, 'Trade Entry'),
                        React.createElement('div', { 
                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                isValidTrade ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                            }`
                        }, isValidTrade ? 'Valid Setup' : 'Incomplete')
                    ),
                    
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4 mb-6' },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Symbol *'),
                            React.createElement('input', {
                                type: 'text',
                                value: currentTrade.symbol,
                                onChange: (e) => handleTradeInputChange('symbol', e.target.value.toUpperCase()),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: 'EURUSD'
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Direction *'),
                            React.createElement('select', {
                                value: currentTrade.side,
                                onChange: (e) => handleTradeInputChange('side', e.target.value),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent'
                            },
                                React.createElement('option', { value: 'long' }, 'Long (Buy)'),
                                React.createElement('option', { value: 'short' }, 'Short (Sell)')
                            )
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Entry Price *'),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.00001',
                                value: currentTrade.entryPrice,
                                onChange: (e) => handleTradeInputChange('entryPrice', e.target.value),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: '1.08500'
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Stop Loss *'),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.00001',
                                value: currentTrade.stopLoss,
                                onChange: (e) => handleTradeInputChange('stopLoss', e.target.value),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: '1.08000'
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Take Profit *'),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.00001',
                                value: currentTrade.takeProfit,
                                onChange: (e) => handleTradeInputChange('takeProfit', e.target.value),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: '1.09500'
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Position Size (lots) *'),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                max: tradingRules.maxPositionSize,
                                value: currentTrade.positionSize,
                                onChange: (e) => handleTradeInputChange('positionSize', e.target.value),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: '0.01'
                            }),
                            React.createElement('div', { className: 'text-xs text-gray-500 mt-1' },
                                `Max: ${tradingRules.maxPositionSize} lots`
                            )
                        )
                    ),

                    currentTrade.riskRewardRatio > 0 && React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg mb-6' },
                        React.createElement('h3', { className: 'font-semibold mb-3' }, 'Risk Assessment'),
                        React.createElement('div', { className: 'grid grid-cols-3 gap-4 text-center' },
                            React.createElement('div', null,
                                React.createElement('div', { className: 'text-lg font-bold text-red-600' }, 
                                    `${currentTrade.riskAmount.toFixed(0)}`
                                ),
                                React.createElement('div', { className: 'text-sm text-gray-600' }, 'Risk Amount')
                            ),
                            React.createElement('div', null,
                                React.createElement('div', { className: 'text-lg font-bold text-green-600' }, 
                                    `${currentTrade.potentialReward.toFixed(0)}`
                                ),
                                React.createElement('div', { className: 'text-sm text-gray-600' }, 'Potential Reward')
                            ),
                            React.createElement('div', null,
                                React.createElement('div', { 
                                    className: `text-lg font-bold ${
                                        currentTrade.riskRewardRatio >= 2 ? 'text-green-600' : 
                                        currentTrade.riskRewardRatio >= 1.5 ? 'text-yellow-600' : 'text-red-600'
                                    }`
                                }, `1:${currentTrade.riskRewardRatio.toFixed(1)}`),
                                React.createElement('div', { className: 'text-sm text-gray-600' }, 'Risk:Reward')
                            )
                        )
                    ),

                    React.createElement('div', { className: 'space-y-4 mb-6' },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' },
                                `Confidence Level: ${currentTrade.confidence}/5`
                            ),
                            React.createElement('input', {
                                type: 'range',
                                min: '1',
                                max: '5',
                                value: currentTrade.confidence,
                                onChange: (e) => handleTradeInputChange('confidence', parseInt(e.target.value)),
                                className: 'w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer'
                            }),
                            React.createElement('div', { className: 'flex justify-between text-xs text-gray-500 mt-1' },
                                React.createElement('span', null, 'Very Low'),
                                React.createElement('span', null, 'Low'),
                                React.createElement('span', null, 'Medium'),
                                React.createElement('span', null, 'High'),
                                React.createElement('span', null, 'Very High')
                            )
                        ),

                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Trade Notes'),
                            React.createElement('textarea', {
                                value: currentTrade.notes,
                                onChange: (e) => handleTradeInputChange('notes', e.target.value),
                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                rows: '3',
                                placeholder: 'Why are you taking this trade? What\'s your analysis?'
                            })
                        )
                    ),

                    React.createElement('div', { className: 'flex gap-4' },
                        React.createElement('button', {
                            onClick: () => setCurrentView('checklist'),
                            className: 'flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-gray-600 transition-colors'
                        }, 'Back to Checklist'),
                        React.createElement('button', {
                            onClick: submitTrade,
                            disabled: !isValidTrade,
                            className: `flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${
                                isValidTrade
                                    ? 'bg-blue-600 text-white hover:bg-blue-700'
                                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                            }`
                        }, isValidTrade ? 'Enter Trade' : 'Complete Required Fields')
                    )
                );
            };

            // Dashboard Component
            const DashboardView = () => {
                const progressToGoal = Math.max(0, (stats.totalPnL / 480000 * 100)).toFixed(1);
                
                return React.createElement('div', { className: 'space-y-6' },
                    // Lock Status
                    isLocked && React.createElement('div', { className: 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                            React.createElement('div', { className: 'flex items-center' },
                                React.createElement(Lock, { className: 'w-5 h-5 mr-2' }),
                                React.createElement('span', { className: 'font-medium' }, 'Trading Suspended')
                            ),
                            lockUntil && React.createElement('div', { className: 'text-sm' },
                                `Until: ${new Date(lockUntil).toLocaleString()}`
                            )
                        ),
                        React.createElement('div', { className: 'mt-1 text-sm' }, lockReason)
                    ),

                    // Active Trades
                    activeTrades.length > 0 && React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-lg p-4' },
                        React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                            React.createElement('h3', { className: 'font-semibold text-blue-900' }, 'Active Trades'),
                            React.createElement('div', { className: 'text-sm text-blue-700' }, 
                                `${activeTrades.length} position${activeTrades.length !== 1 ? 's' : ''}`
                            )
                        ),
                        React.createElement('div', { className: 'space-y-2' },
                            activeTrades.map(trade => 
                                React.createElement('div', { key: trade.id, className: 'bg-white p-3 rounded border flex items-center justify-between' },
                                    React.createElement('div', { className: 'flex items-center space-x-3' },
                                        React.createElement('div', { className: 'font-medium' }, trade.symbol),
                                        React.createElement('div', { 
                                            className: `px-2 py-1 rounded text-xs font-medium ${
                                                trade.side === 'long' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, trade.side.toUpperCase()),
                                        React.createElement('div', { className: 'text-sm text-gray-600' }, trade.setup)
                                    ),
                                    React.createElement('div', { className: 'text-right' },
                                        React.createElement('div', { className: 'text-sm font-medium' }, trade.entryPrice),
                                        React.createElement('div', { className: 'text-xs text-gray-500' }, 
                                            `SL: ${trade.stopLoss} | TP: ${trade.takeProfit}`
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // Goal Progress
                    React.createElement('div', { className: 'bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg' },
                        React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                            React.createElement('h3', { className: 'text-lg font-semibold' }, 'Annual Goal Progress'),
                            React.createElement(Target, { className: 'w-6 h-6' })
                        ),
                        React.createElement('div', { className: 'text-3xl font-bold mb-1' }, 
                            `${stats.totalPnL.toLocaleString()}`
                        ),
                        React.createElement('div', { className: 'text-sm opacity-90' }, 
                            `Target: $480,000 | Remaining: ${(480000 - stats.totalPnL).toLocaleString()}`
                        ),
                        React.createElement('div', { className: 'w-full bg-white bg-opacity-20 rounded-full h-3 mt-3' },
                            React.createElement('div', { 
                                className: 'bg-white h-3 rounded-full transition-all duration-500',
                                style: { width: `${Math.min(progressToGoal, 100)}%` }
                            })
                        ),
                        React.createElement('div', { className: 'text-sm mt-2' }, `${progressToGoal}% complete`)
                    ),

                    // Stats Grid
                    React.createElement('div', { className: 'grid grid-cols-2 lg:grid-cols-4 gap-4' },
                        React.createElement('div', { className: 'bg-white p-4 rounded-lg shadow' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.totalTrades),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Total Trades')
                                ),
                                React.createElement(BarChart3, { className: 'w-8 h-8 text-blue-500' })
                            )
                        ),
                        
                        React.createElement('div', { className: 'bg-white p-4 rounded-lg shadow' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, `${stats.winRate}%`),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Win Rate')
                                ),
                                React.createElement(TrendingUp, { className: 'w-8 h-8 text-green-500' })
                            )
                        ),
                        
                        React.createElement('div', { className: 'bg-white p-4 rounded-lg shadow' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, stats.profitFactor),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Profit Factor')
                                ),
                                React.createElement(Activity, { className: 'w-8 h-8 text-blue-500' })
                            )
                        ),
                        
                        React.createElement('div', { className: 'bg-white p-4 rounded-lg shadow' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('div', { 
                                        className: `text-2xl font-bold ${stats.consecutiveLosses >= 2 ? 'text-red-600' : 'text-green-600'}`
                                    }, stats.consecutiveLosses),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'Consecutive Losses')
                                ),
                                stats.consecutiveLosses >= 2 ? 
                                    React.createElement(XCircle, { className: 'w-8 h-8 text-red-500' }) : 
                                    React.createElement(CheckCircle, { className: 'w-8 h-8 text-green-500' })
                            )
                        )
                    ),

                    // Recent Trades
                    React.createElement('div', { className: 'bg-white rounded-lg shadow' },
                        React.createElement('div', { className: 'p-4 border-b' },
                            React.createElement('h3', { className: 'text-lg font-semibold' }, 'Recent Trades')
                        ),
                        React.createElement('div', { className: 'p-4' },
                            trades.length === 0 ? 
                                React.createElement('div', { className: 'text-center text-gray-500 py-8' },
                                    React.createElement(BarChart3, { className: 'w-12 h-12 mx-auto mb-3 opacity-50' }),
                                    React.createElement('div', { className: 'text-lg font-medium mb-1' }, 'No trades yet'),
                                    React.createElement('div', { className: 'text-sm' }, 'Complete the pre-trade checklist to start trading!')
                                ) :
                                React.createElement('div', { className: 'space-y-3' },
                                    trades.slice(-5).reverse().map(trade => 
                                        React.createElement('div', { 
                                            key: trade.id, 
                                            className: 'flex items-center justify-between p-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors' 
                                        },
                                            React.createElement('div', { className: 'flex items-center space-x-3' },
                                                React.createElement('div', { className: 'font-medium' }, trade.symbol),
                                                React.createElement('div', { 
                                                    className: `px-2 py-1 rounded text-xs font-medium ${
                                                        trade.side === 'long' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                    }`
                                                }, trade.side.toUpperCase()),
                                                React.createElement('div', { className: 'text-sm text-gray-600' }, trade.setup),
                                                React.createElement('div', { 
                                                    className: `text-sm font-medium ${
                                                        trade.outcome === 'win' ? 'text-green-600' : 'text-red-600'
                                                    }`
                                                }, `${trade.pnl > 0 ? '+' : ''}${trade.pnl.toFixed(0)}`)
                                            ),
                                            React.createElement('div', { className: 'text-right' },
                                                React.createElement('div', { className: 'font-medium' }, trade.entryPrice),
                                                React.createElement('div', { className: 'text-xs text-gray-500' },
                                                    new Date(trade.timestamp).toLocaleTimeString()
                                                )
                                            )
                                        )
                                    )
                                )
                        )
                    )
                );
            };

            return React.createElement('div', { className: 'min-h-screen bg-gray-100' },
                // Header
                React.createElement('div', { className: 'bg-white shadow-sm border-b' },
                    React.createElement('div', { className: 'max-w-6xl mx-auto px-4 py-4' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                            React.createElement('div', { className: 'flex items-center space-x-3' },
                                React.createElement(Target, { className: 'w-8 h-8 text-blue-600' }),
                                React.createElement('div', null,
                                    React.createElement('h1', { className: 'text-2xl font-bold text-gray-900' }, 'MbaloTech Trading'),
                                    React.createElement('div', { className: 'text-sm text-gray-500' }, 'Professional Trading Assistant')
                                )
                            ),
                            React.createElement('div', { className: 'text-right' },
                                React.createElement('div', { className: 'text-sm text-gray-600' },
                                    new Date().toLocaleDateString('en-US', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    })
                                ),
                                React.createElement('div', { className: 'text-xs text-gray-500 flex items-center justify-end' },
                                    React.createElement(Clock, { className: 'w-3 h-3 mr-1' }),
                                    new Date().toLocaleTimeString()
                                )
                            )
                        )
                    )
                ),

                // Navigation
                React.createElement('div', { className: 'max-w-6xl mx-auto px-4 py-4' },
                    React.createElement('div', { className: 'flex flex-wrap gap-4 mb-6' },
                        React.createElement('button', {
                            onClick: () => setCurrentView('dashboard'),
                            className: `px-4 py-2 rounded-lg font-medium transition-colors ${
                                currentView === 'dashboard' 
                                    ? 'bg-blue-600 text-white' 
                                    : 'bg-white text-gray-700 hover:bg-gray-50'
                            }`
                        }, 'Dashboard'),
                        React.createElement('button', {
                            onClick: () => setCurrentView('checklist'),
                            disabled: isLocked,
                            className: `px-4 py-2 rounded-lg font-medium transition-colors ${
                                currentView === 'checklist' 
                                    ? 'bg-blue-600 text-white' 
                                    : isLocked 
                                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        : 'bg-white text-gray-700 hover:bg-gray-50'
                            }`
                        }, 
                            React.createElement(Plus, { className: 'w-4 h-4 inline mr-1' }),
                            'New Trade'
                        ),
                        React.createElement('button', {
                            onClick: () => emergencyStop('Manual emergency stop activated'),
                            disabled: isLocked,
                            className: 'px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed'
                        },
                            React.createElement(AlertTriangle, { className: 'w-4 h-4 inline mr-1' }),
                            'Emergency Stop'
                        )
                    ),

                    // Main Content
                    React.createElement('div', { className: 'max-w-5xl mx-auto' },
                        currentView === 'dashboard' && React.createElement(DashboardView),
                        currentView === 'checklist' && React.createElement(PreTradeChecklistView),
                        currentView === 'trade-entry' && React.createElement(TradeEntryView)
                    )
                )
            );
        };

        // Initialize app after page loads
        window.addEventListener('load', () => {
            // Hide loading screen
            document.getElementById('loading').style.display = 'none';
            document.getElementById('root').style.display = 'block';
            
            // Render app
            ReactDOM.render(React.createElement(MbaloTechTradingApp), document.getElementById('root'));
        });
    </script>
</body>
</html>